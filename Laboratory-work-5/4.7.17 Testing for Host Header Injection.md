# Тестування для впровадження заголовка хосту
Веб-сервер зазвичай розміщує кілька веб-програм на одній IP-адресі, звертаючись до кожної програми через віртуальний хост. У вхідному HTTP-запиті веб-сервери часто надсилають запит цільовому віртуальному хосту на основі значення, указаного в заголовку Host. Без належної перевірки значення заголовка зловмисник може надати недійсні вхідні дані, щоб змусити веб-сервер:

1. надсилати запити на перший віртуальний хост у списку
2. викликати переспрямування на контрольований зловмисником домен
3. виконати отруєння веб-кешу
4. маніпулювати функцією скидання пароля

# Цілі тесту
1. Оцініть, чи заголовок Host динамічно аналізується в програмі.
2. Обійти засоби безпеки, які залежать від заголовка.

# Як тестувати
Початкове тестування таке ж просте, як надання іншого домену (наприклад, attacker.com) у полі заголовка Host. Саме те, як веб-сервер обробляє значення заголовка, визначає вплив. Атака дійсна, коли веб-сервер обробляє вхідні дані для надсилання запиту на контрольований зловмисником хост, який знаходиться в наданому домені, а не на внутрішній віртуальний хост, який знаходиться на веб-сервері.

GET / HTTP/1.1
Host: www.attacker.com
[...]

У найпростішому випадку це може спричинити перенаправлення 302 на наданий домен.

HTTP/1.1 302 Found
[...]
Location: http://www.attacker.com/login.php

Крім того, веб-сервер може надіслати запит першому віртуальному хосту в списку.

# Обхід заголовка хосту, перенаправленого X
Якщо впровадження заголовка Host пом’якшується шляхом перевірки недійсних введених даних через заголовок Host, ви можете надати значення в заголовок X-Forwarded-Host.

GET / HTTP/1.1
Host: www.example.com
X-Forwarded-Host: www.attacker.com
...

Потенційно створює вихідні дані на стороні клієнта, наприклад:

...
<link src="http://www.attacker.com/link" />
...

Знову ж таки, це залежить від того, як веб-сервер обробляє значення заголовка.

# Отруєння веб-кеша
Використовуючи цю техніку, зловмисник може маніпулювати веб-кешем, щоб надавати отруєний вміст усім, хто його запитує. Це залежить від здатності отруїти проксі-сервер кешування, який запускається самою програмою, CDN або іншими провайдерами. У результаті жертва не матиме контролю над отриманням шкідливого вмісту під час запиту вразливої програми.

GET / HTTP/1.1
Host: www.attacker.com
...

Коли жертва відвідує вразливу програму, з веб-кешу буде подано наступне.

...
<link src="http://www.attacker.com/link" />
...

# Отруєння для скидання пароля
Функція скидання пароля зазвичай включає значення заголовка Host під час створення посилань для скидання пароля, які використовують згенерований секретний маркер. Якщо програма обробляє контрольований зловмисником домен для створення посилання для скидання пароля, жертва може натиснути посилання в електронному листі та дозволити зловмиснику отримати маркер скидання, таким чином скидаючи пароль жертви.

... Email snippet ...

Click on the following link to reset your password:

http://www.attacker.com/index.php?module=Login&action=resetPassword&token=<SECRET_TOKEN>

... Email snippet ...




